<!DOCTYPE html>
<html>
<head>
  <title>Employee Dashboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2 style="text-align:center;">Employee Dashboard</h2>

<div class="container">
  <input type="text" id="title" placeholder="Request Title">
  <input type="text" id="description" placeholder="Description">
  <input type="text" id="requestedTo" placeholder="Admin ID">
  <button onclick="createRequest()">Create Request</button>
</div>

<table id="requestTable">
  <thead>
    <tr>
      <th>Title</th>
      <th>Description</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const token = localStorage.getItem("token");

  async function createRequest() {
    const title = document.getElementById("title");
    const description = document.getElementById("description");
    const requestedTo = document.getElementById("requestedTo");

    if (!title.value || !description.value || !requestedTo.value) {
      alert("All fields are required");
      return;
    }

    const res = await fetch("http://localhost:3000/requests/create", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
  title: title.value,
  description: description.value,
  adminId: requestedTo.value   
})

    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.message);
      return;
    }

    alert("Request created successfully");
    fetchRequests();
  }

  async function fetchRequests() {
    const res = await fetch("http://localhost:3000/requests/revoke-request/myrequests", {
      headers: { "Authorization": "Bearer " + token }
    });

    const tbody = document.querySelector("tbody");
    tbody.innerHTML = "";

    if (!res.ok) {
      const errorData = await res.json();
      alert(errorData.message);   
      return;                     
    }

    const data = await res.json();

    if (!data.requests || !Array.isArray(data.requests)) return;

    data.requests.forEach(req => {
      tbody.innerHTML += `
        <tr>
          <td>${req.title}</td>
          <td>${req.requestType}</td>
          <td>${req.description}</td>
          <td>${req.status || "PENDING"}</td>
        </tr>
      `;
    });
  }

  fetchRequests();
</script>
